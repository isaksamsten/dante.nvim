<p align="center">
<img src="https://raw.githubusercontent.com/isaksamsten/sia.nvim/refs/heads/main/assets/logo.png?raw=true" alt="Logo" width="200px">
</p>
<h1 align="center">sia.nvim</h1>

An LLM assistant for Neovim with support for OpenAI and Copilot.

## ‚ú® Features

https://github.com/user-attachments/assets/26f0a7e6-2afd-4b69-b4c3-f9945721f442

## ‚ö°Ô∏è Requirements

- Neovim >= **0.10**
- curl
- Access to OpenAI API or Copilot

## üì¶ Installation

1. Install using a Lazy:

```lua
{
  "isaksamsten/sia.nvim",
  opts = {},
  dependencies = {
    {
      "rickhowe/diffchar.vim",
      keys = {
        { "[z", "<Plug>JumpDiffCharPrevStart", desc = "Previous diff", silent = true },
        { "]z", "<Plug>JumpDiffCharNextStart", desc = "Next diff", silent = true },
        { "do", "<Plug>GetDiffCharPair", desc = "Obtain diff", silent = true },
        { "dp", "<Plug>PutDiffCharPair", desc = "Put diff", silent = true },
      },
    },
  },
}
```

2. [get an OpenAI API key](https://platform.openai.com/docs/api-reference/introduction) and add it to your environment as `OPENAI_API_KEY`.

## üì¶ Customize

TODO

### Autocommands

`sia.nvim` emits the following autocommands:

- `SiaUsageReport`: when the number of tokens are known
- `SiaStart`: query has been submitted
- `SiaProgress`: a response has been received
- `SiaComplete`: the query is completed
- `SiaEditPost`: after a buffer has been edited

## üöÄ Usage

**Normal Mode**

- `:Sia [query]` sends the query and opens a split view with the response.
- `:Sia [query]` if run from a conversation, continues the conversation with the new query.
- `:Sia /prompt [query]` executes the prompt with the optional additional query.
- `:Sia! [query]` sends the query and inserts the response.

- `:SiaFile` displays the files in the global file list; or if run from a split, shows the files associated with the current conversation.
- `:SiaFile patterns` adds files matching the patterns to the global file list; or if run from a split, adds them to the current conversation.
- `:SiaFileDelete patterns` removes files matching the patterns from the global file list; or if run from a split, removes them from the current conversation.

- `:SiaAccept` accepts a suggested edit. For example, `:cdo SiaAccept` accepts all suggested changes.
- `:SiaReject` rejects a suggested edit.

**Ranges**

Any range is supported, for example:

- `:'<,'>Sia! [query]` send the selected lines and query and diff the response
- `:'<,'>Sia [query]` send the selected lines and query and open a split with the response.
- `:'<,'>Sia /prompt [query]` execute the prompt with the extra query.

**Examples**

- `:%Sia fix the test function` - open a split with a fix to the test function.
- `:Sia write snake in pygame` - open a split with the answer.
- `:Sia /doc numpydoc` - document the function or class under cursor with numpydoc format.
- `:SiaFile a.py b.py | Sia move the function foo_a to b.py`
- `:%Sia /diagnostic` - open a split with a solution to diagnostics in the current file.

### Suggested keybindings:

Defined in `lazy.nvim` I suggest the following keybindings (imitating
`vim.dispatch`):

```lua
  keys = {
    { "<LocalLeader><space>", mode = { "v", "n" }, ":Sia ", desc = ":Sia " },
    { "<LocalLeader><cr>", mode = { "v", "n" }, ":Sia<cr>", desc = ":Sia" },
    { "<LocalLeader>%", mode = { "n" }, ":%Sia ", desc = "%:Sia" },
  },
```

We can also bind visual and operator mode bindings to

- `<Plug>(sia-append)` append the current selection or operator mode selection
  to the current split or create a new.
- `<Plug>(sia-execute)` execute the default prompt (`vim.b.sia`) with
  selection or operator mode selection.

```lua
keys = {
  { "gza", mode = { "n", "x" }, "<Plug>(sia-append)" },
  { "gzz", mode = { "n", "x" }, "<Plug>(sia-execute)" },
}
```

Then we can send the current paragraph to the default prompt with `gzzip` or
append the current method (assuming `treesitter-textobjects`) to the ongoing
chat with `gzaim`.

Sia also creates Plug bindings for all promps under
`<Plug>(sia-execute-<PROMPT>)`, e.g., `<Plug>(sia-execute-explain)` for the
default prompt `/explain`.

```lua
keys = {
  { "gze", mode = { "n", "x" }, "<Plug>(sia-execute-explain)" },
}
```

**Chat**

From the chat, we can replace and insert code-blocks generated by the LLM using

- `ga` insert/add at current cursor position in another open buffer (or a
  buffer specified by the LLM)
- `gr` replace the lines specified by the LLM with the output

## üôè Acknowledgments

This plugin is based on a fork of

- [S1M0N38/dante.nvim](https://github.com/S1M0N38/dante.nvim)
